WITH foundation_list AS (
  SELECT *
  FROM (VALUES
('0x1770bd8186aad27df9b050d65f86cf2cdc92c296'), -- Community Year1
('0xaee0360b73b5d01dad134f234d3a93adc1680e57'), -- Community Year2
('0x0d4ca2ff883d429ce4372eeb056efafab181cce7'), -- Investor and Team
('0xfb7f100ed6793fcd63e6e9f201be9aa567b2c9cc'), -- Team
('0x938ced2d1ee4afb220929f96c2eb754c053c77f7'), -- Community Year3
('0x5b5442c5fceae3b40c230c32a3ffe924bcbe7d93'), -- Community Year4
('0x59a0f98345f54bab245a043488ece7fcecd7b596'), -- Community
('0x7f26a7572e8b877654eedcbc4e573657619fa3ce'), -- Optimism Community
('0xf8cf291d92e52b722c31af1fde9f0d7e890e0e0a'), -- Distributor main
('0xf8cf291d92e52b722c31af1fde9f0d7e890e0e0a'),
('0xc7c914a5630940db34671892189f96251ec23741'),
('0xfea5ac235b2205a899f040c3c80a0f89d209f7c7'),
('0x2760a575c6a243b0533c43567d0a255aab53a448'),
('0x1bd827e4323c3620a06afd03d2ea2c22e760b983'),
('0x11e9a975fec8f5e6df0e865a1dadd3b68116dbf0'),
('0xabe9b4f3164bf6a2f6cfd755a77e406aea95cc0b'),
('0x61060fbe50e7c9dee2a61f6b98206e9f9da81374'),
('0xb0196593da941ac04ccbc6a6cfae61fb42c85fe9'),
('0x6c5c95f0940fe357cc0fb20bf284c915b7535229'),
('0xaea014ebc2a601adf325d6e420f17c2045aab5e6'),
('0x6070482eaa5914501526b1396c8849eb31dcd212'),
('0x603f71b0d39f45f764d1ce5629c7c7a9be1a7c93'),
('0xa82e1a172c267058edd8801606285679f41f9c7d'),
('0xc2fcf257f0d4f58d8e5234e5f5af243cd9f6658c'),
('0xfd25ed845abefe5bbf4feb8a0f65fe24bffdf73c'),
('0xc597e8e0fa4f2be596a83c495a6f05aa019b0a71'),
('0x9bc98e33fb58d2bbda03b51276a62d3ac41ea1be'),
('0x4871c7c566e8c83a56270f53144f30591bbb60cd'),
('0xc7c914a5630940db34671892189f96251ec23741'),
('0xfea5ac235b2205a899f040c3c80a0f89d209f7c7'),
('0x2760a575c6a243b0533c43567d0a255aab53a448'),
('0x1bd827e4323c3620a06afd03d2ea2c22e760b983'),
('0x11e9a975fec8f5e6df0e865a1dadd3b68116dbf0'),
('0xabe9b4f3164bf6a2f6cfd755a77e406aea95cc0b'),
('0x61060fbe50e7c9dee2a61f6b98206e9f9da81374'),
('0xb0196593da941ac04ccbc6a6cfae61fb42c85fe9'),
('0x6c5c95f0940fe357cc0fb20bf284c915b7535229'),
('0xaea014ebc2a601adf325d6e420f17c2045aab5e6'),
('0x6070482eaa5914501526b1396c8849eb31dcd212'),
('0x603f71b0d39f45f764d1ce5629c7c7a9be1a7c93'),
('0xa82e1a172c267058edd8801606285679f41f9c7d'),
('0xc2fcf257f0d4f58d8e5234e5f5af243cd9f6658c'),
('0xfd25ed845abefe5bbf4feb8a0f65fe24bffdf73c'),
('0xc597e8e0fa4f2be596a83c495a6f05aa019b0a71'),
('0x9bc98e33fb58d2bbda03b51276a62d3ac41ea1be'),
('0x4871c7c566e8c83a56270f53144f30591bbb60cd'),
('0xf944961376fc0c9d63bbbafb1ec88fccb0a5e014'),
('0x54206c29141164f28017e7518d18985844d4e657'),
('0x95c7f7a8e0b8aa7e946a583c543090d63786c48f'),
('0x70779c76fc7269caa65f23a2854bd8414ec3b1e5'),
('0xe5f99bd4296e77f546e626da1a65ae0cdfcd7dea'),
('0x4f3160e3ef0396721631f75591e57ad7eec70f32'),
('0x68b0db3a82d97a0f24cd68edadfcbc03c22e1a10'),
('0x946e77abe5f5d0f84eb5b436fa1fc432d8119cbe'),
('0x5cf986e0f77822bde4f8747a62e4eab966694773'),
('0xc1a9d8612149c7f6821fc8c05221e471ff01a87a'),
('0x5094d81b50bca176905622efe6dbab590fdc0bf0'),
('0xfd6569f826ce490cda9d469cb959cb827f99f334'),
('0x5d5ba39109c13218109400756cdb8d536dc98aee'),
('0x8674a79d7c2ae3eb1ad8314c3cb1d0eb90a06b28'),
('0xb474edfc2e1b3209ab8eda0754464249ba54689e'),
('0xc20395c27374b0a206204688c25c8d998b8fbbf4'),
('0xa4762db4b49dae0be26c05d4535741ab88eb02d3'),
('0x5d547e539351e73f3e0da314b82fb5532e0aef6b'),
('0x85ea47089dd0a12616261428cce1138237178601'),
('0x1ecb905e9cc92963f3baadc34b8e072f09edbdb5'),
('0x579a7138707d606164fe70df3ed3cb466f1155ee'),
('0xc03ed23b6b14921f3cee799a565f63b59de189d3'),
('0xdd2ff3a58a66350eec12048f1b6d0125e64f328c'),
('0x2306cfe8b11042d8c844f0ec73d0b9adc67610eb'),
('0x963a187ea4f1ee1be3cc8fc3a42e59895b555226'),
('0xd785f95d0e3f04c709091bce2ebeccd96c8a66cd'),
('0x958b56949e3890fc5f84c74c0987ffaf7c5ff0aa'),
('0xb43734df51a08319bb63013a594c2898472ee5ba'),
('0xaaed54af43321a2d6edc364ea91e61293549c69e'),
('0xdbc7b54c665e9c6c75d1fe884d251a58288c287f'),
('0x81d0197fc7133a373ab7ae8dd23f1251e5f90668'),
('0xe66799352e07715fe66c2afcdda830dfd1666e0c'),
('0x7250f754fd6f379648b6b0070f62c93b1febd821'),
('0x58706f3cbfcd05c68e03f83daedbc0aa6ab4b45c'),
('0xeaec9dcca1f8d91567cf66cd591cf4ddfa09322d'),
('0x01fdd853b411579faa44061507d28e9068b69eaf'),
('0xcf5cf0b285bcde2d4423862f1232e4a396ad5c8c'),
('0x328692a57622561d096896cad16d1ef0b05762fb'),
('0x0858dccef1aa316724a2bb16cb4d6d1e86b862a7'),
('0x9a2998efa7fc091803ba6afa884a3b122a076fab'),
('0x63250a0c29121449482354a82767eedfeb88c822'),
('0x7814d26eb0c44cf7a06a49e4a4d44222104f9bba'),
('0x27b9b2098be5d678d64027ca9a1a1adae995eef2'),
('0xefacf9817c387e127a059f1687e4276a955ca7e4'),
('0xcde7f3f251d421928113e8bac271eb0e6bb60900'),
('0xf91f5456d1372fbae7e909043f94c2d7d52d0a0c'),
('0x696aa36ac982b557cd0d61e4a3d892ae2cca6f8f'),
('0x88bf63a1ff039fd236748f8e6289390679ae1ce6'),
('0x40b7f356e96c46ef646909bbff9ee96b9d695018'),
('0xf02e86d9e0efd57ad034faf52201b79917fe0713'),
('0x10d4b2cd8b26c988cd4acc4860feba4d12af846e'),
('0x343abaa0450919177ea764da37014f8e076d0760'),
('0xc920d2fd838975498157f9ffd82df64f31e5494e'),
('0x51d4c46830d568229d61fff26823d973d18024a5'),
('0xdc2c8ba3b3119b54138898dc6b4ab88f9b3cbb22'),
('0x6091dbf629000316c118146b52522fa39ae82f93'),
('0xa42f6b3e85707467e4694519bce84fc6efd0fca9'),
('0xde048cac7e12fe24bd3f386cbdbcb7e671d47cd7'),
('0x87b495d48eafda90795de65af734424d50b0c324'),
('0x3f580184453b175f307857e8d66be77dc7e5873d'),
('0x4fd641226070b4a27fcc5819ed317ed09a3aeb24'),
('0x387ca2ad6da99f983fcd7aebbffcfba3d3e9f0c9'),
('0x9bce0db5f42d249ed8652e6fbe4fd7fc9acc91d9'),
('0xfe5ce78d064a682e9016aa51f9a0e69c2da1ad45'),
('0x01f47a35e46a42a03c60d562708c55f1e4a713b2'),
('0x2c73e8a6ac985f5b58300d4d01768fdeed34ff90'),
('0xafcc52ae112baf5d219f7bd1d74ff5d623704099'),
('0xd0f7c17a5082abf03189e12a607a08f009f6576b'),
('0xea3940a1bc1a384bc756de301b260040722fef6a'),
('0x5eb0e20b7bb3157b97f4e72b36f9797b2f4409b3'),
('0x9a946021078d47d8506dfe9689cffa7d837de39b'),
('0xf6c676476b61b3895008632368dbdf712f355f73'),
('0x95b4972ce2d32a09524204779544c0b728d7f8ec'),
('0xf3bce62a2ace74751be4ee0109decd44c97a05d8'),
('0xe169b927a4de8b874e159f191f8bcd56d805f883'),
('0xac8044d9a2bb9c313a283bbfcb3c3a929464737a'),
('0x0e778c430297868cfca8db7435d603db141543cd'),
('0x5adb9de54d02b79c0a150c0c44478c445b312852'),
('0x581e3d5955e9890e3f9e8289d77935386f792f2e'),
('0x32d654758a7411fb3be2ea3c414728f1e46a58ab'),
('0x26c16d1a91cebf7761136f8ed79d6b8d8127fbbb'),
('0x0cb41e06b2f2203eb272f546d2013a782b401d8f'),
('0x83a510ddbdb14839be1511709e213bca94ea7849')
      )
  AS foundation(FOUNDATION)
),
  daily_transfers AS (
    SELECT
      DATE(BLOCK_TIMESTAMP) as TIMESTAMP,
      SUM(
        CASE
          WHEN FROM_ADDRESS IN (SELECT FOUNDATION FROM foundation_list) THEN - RAW_AMOUNT/POW(10, 18)
          WHEN TO_ADDRESS IN (SELECT FOUNDATION FROM foundation_list) THEN RAW_AMOUNT/POW(10, 18)
          ELSE 0
        END
      ) AS daily_balance_change
    FROM
      ethereum.core.ez_token_transfers
    WHERE
      CONTRACT_ADDRESS = LOWER('0x163f8c2467924be0ae7b5347228cabf260318753')
      AND (FROM_ADDRESS in (SELECT FOUNDATION FROM foundation_list) OR TO_ADDRESS in (SELECT FOUNDATION FROM foundation_list))
      AND NOT (FROM_ADDRESS in (SELECT FOUNDATION FROM foundation_list) AND TO_ADDRESS in (SELECT FOUNDATION FROM foundation_list))
    GROUP BY TIMESTAMP
  UNION ALL
    SELECT
      DATE(BLOCK_TIMESTAMP) as TIMESTAMP,
      SUM(
        CASE
          WHEN FROM_ADDRESS IN (SELECT FOUNDATION FROM foundation_list) THEN - RAW_AMOUNT/POW(10, 18)
          WHEN TO_ADDRESS IN (SELECT FOUNDATION FROM foundation_list) THEN RAW_AMOUNT/POW(10, 18)
          ELSE 0
        END
      ) AS daily_balance_change
    FROM
      optimism.core.ez_token_transfers
    WHERE
      CONTRACT_ADDRESS = LOWER('0xdc6ff44d5d932cbd77b52e5612ba0529dc6226f1')
      AND (FROM_ADDRESS in (SELECT FOUNDATION FROM foundation_list) OR TO_ADDRESS in (SELECT FOUNDATION FROM foundation_list))
      AND NOT (FROM_ADDRESS in (SELECT FOUNDATION FROM foundation_list) AND TO_ADDRESS in (SELECT FOUNDATION FROM foundation_list))
    GROUP BY TIMESTAMP
  )

SELECT
  DISTINCT TIMESTAMP AS DATE,
  10000000000 - SUM(daily_balance_change) OVER (
    ORDER BY
      TIMESTAMP
  ) AS CIRCULATING,
  (EXTRACT(EPOCH FROM TIMESTAMP) - 1690156800 )/86400 AS DAYS,
  CASE
    WHEN DAYS < 0 THEN 500000000
    WHEN DAYS < 365 THEN 500000000 + DAYS * 3196347.032
    WHEN DAYS BETWEEN 365 AND 1096 THEN 1666666667 + (DAYS-365) * 4409975.669
    WHEN DAYS BETWEEN 1096 AND 2192 THEN 6500000000 + (DAYS-1096) * 798357.6642
    WHEN DAYS BETWEEN 2192 AND 3288 THEN 8250000000 + (DAYS-2192) * 266119.2214
    WHEN DAYS BETWEEN 3288 AND 5479 THEN 9125000000 + (DAYS-3288) * 159700.6753
    WHEN DAYS > 5479 THEN 10000000000
  END AS PLANNED
FROM
  daily_transfers
ORDER BY
  TIMESTAMP;

