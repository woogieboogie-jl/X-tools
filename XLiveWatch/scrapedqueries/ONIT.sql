WITH foundation_list AS (
  SELECT *
  FROM (VALUES
        ('0x665f1f5cae0bf6a553742bc28a226d974c9d881a'), -- Deployer
        ('0x000000000000000000000000000000000000dead'), -- (19,810,134 ONIT burn)
        ('0xe2946508daf52ee8650f600881cc33db9235a342'), -- Foundation, send to dead ad
        ('0x1cce01e76698612c8fbab6c7724071209c0bda94'), -- Development, send to dead ad
        ('0xfb4626f4355cabe2a75bf98fd041987ac804785e'), -- Ecosystem
        ('0xdebe8c1780a0a85404ae47e61db58123819b9685'), -- Marketing
        ('0xfcaacab6ded8f6baaed1dd2dfeb58e4097d08a90') -- Seed around?  -- not be clearly found (Team&Advisors + Private round)
      )
  AS foundation(FOUNDATION)
),
  daily_transfers AS (
    SELECT
      DATE(BLOCK_TIMESTAMP) as TIMESTAMP,
      SUM(
        CASE
          WHEN FROM_ADDRESS IN (SELECT FOUNDATION FROM foundation_list) THEN - RAW_AMOUNT/POW(10, 18)
          WHEN TO_ADDRESS IN (SELECT FOUNDATION FROM foundation_list) THEN RAW_AMOUNT/POW(10, 18)
          ELSE 0
        END
      ) AS daily_balance_change
    FROM
      ethereum.core.ez_token_transfers
    WHERE
      CONTRACT_ADDRESS = LOWER('0x410e731c2970Dce3AdD351064AcF5cE9E33FDBf0')
      AND (FROM_ADDRESS in (SELECT FOUNDATION FROM foundation_list) OR TO_ADDRESS in (SELECT FOUNDATION FROM foundation_list))
      AND NOT (FROM_ADDRESS in (SELECT FOUNDATION FROM foundation_list) AND TO_ADDRESS in (SELECT FOUNDATION FROM foundation_list))
    GROUP BY TIMESTAMP
)
SELECT
  DISTINCT TIMESTAMP AS DATE,
   770075466  - SUM(daily_balance_change) OVER (
    ORDER BY
      TIMESTAMP
  ) AS CIRCULATING,
  (EXTRACT(EPOCH FROM TIMESTAMP) - 1598864400)/86400 AS DAYS, -- 2020/08/31
  CASE
    WHEN DAYS = 0 THEN  10000000 
    WHEN DAYS BETWEEN 0 AND 30 THEN 10000000 + DAYS * 852582.20 
    WHEN DAYS BETWEEN 30 AND 61 THEN 35577466 + (DAYS-30) * 1307967.74
    WHEN DAYS BETWEEN 61 AND 91 THEN 76124466 + (DAYS-61) * 1034900.00
    WHEN DAYS BETWEEN 91 AND 122 THEN 107171466 + (DAYS-91) * 1494096.77
    WHEN DAYS BETWEEN 122 AND 153 THEN 153488466 + (DAYS-122) * 1325387.10 
    WHEN DAYS BETWEEN 153 AND 181 THEN 194575466 + (DAYS-153) * 910714.29
    WHEN DAYS BETWEEN 181 AND 212 THEN 220075466 + (DAYS-181) * 1161290.32
    WHEN DAYS BETWEEN 212 AND 242 THEN 256075466 + (DAYS-212) * 866666.67
    WHEN DAYS BETWEEN 242 AND 273 THEN 282075466 + (DAYS-242) * 1161290.32 
    WHEN DAYS BETWEEN 273 AND 303 THEN 318075466 + (DAYS-273) * 1200000.00
    WHEN DAYS BETWEEN 303 AND 334 THEN 354075466 + (DAYS-303) * 1161290.32
    WHEN DAYS BETWEEN 334 AND 365 THEN 390075466 + (DAYS-334) * 838709.68
    WHEN DAYS BETWEEN 365 AND 395 THEN 416075466 + (DAYS-365) * 816666.67 
    WHEN DAYS BETWEEN 395 AND 426 THEN 440575466 + (DAYS-395) * 1112903.23
    WHEN DAYS BETWEEN 426 AND 456 THEN 475075466 + (DAYS-426) * 816666.67 
    WHEN DAYS BETWEEN 456 AND 487 THEN 499575466 + (DAYS-456) * 1112903.23 
    WHEN DAYS BETWEEN 487 AND 518 THEN 534075466 + (DAYS-487) * 790322.58
    WHEN DAYS BETWEEN 518 AND 546 THEN 558575466 + (DAYS-518) * 1232142.86 
    WHEN DAYS BETWEEN 546 AND 577 THEN 593075466 + (DAYS-546) * 790322.58
    WHEN DAYS BETWEEN 577 AND 607 THEN 617575466 + (DAYS-577) * 1150000.00 
    WHEN DAYS BETWEEN 607 AND 638 THEN 652075466 + (DAYS-607) * 790322.58
    WHEN DAYS BETWEEN 638 AND 668 THEN 676575466 + (DAYS-638) * 1150000.00
    WHEN DAYS BETWEEN 668 AND 699 THEN 711075466 + (DAYS-668) * 790322.58 
    WHEN DAYS BETWEEN 699 AND 730 THEN 735575466 + (DAYS-699) * 1112903.23
    WHEN DAYS > 730 THEN 770075466 
  END AS PLANNED
FROM
  daily_transfers
ORDER BY
  TIMESTAMP; 

