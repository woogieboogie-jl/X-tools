WITH foundation_list AS (
  SELECT *
  FROM (VALUES
        ('0xb035066a8bd547e447c579971a031141ea46312d'), -- Internal Team
        ('0x3dbca45236c73a045963c701d0043629e9f79574'), -- Reserve
        ('0x025e8ebf9852f7f82603630bc8ed8cf0d14122c4'), -- Private Sale
        ('0x517c1ee3fd8ba15784bb879b5afa2b3859631ef2'), -- Advisor & Team
        ('0x98ca57f5fca4627b8fb158852b95eb3fa078d27d'), -- Community
        ('0x3199f60d61e40d627a4336febb5184397c763c0e'), -- GnosisSafeProxy
        ('0xa2321921f08cfdac7aafd3255fed92e7ba2774d3'), -- GnosisSafeProxy
        ('0xe362babd4b6d6084dbbacb08405fdba71f91848e'), -- GnosisSafeProxy
        ('0x8c7e214c17866671ac9b4a2afc1df94c0c69f20b')  -- Deployer
      )
  AS foundation(FOUNDATION)
),
  daily_transfers AS (
    SELECT
      DATE(BLOCK_TIMESTAMP) as TIMESTAMP,
      SUM(
        CASE
          WHEN FROM_ADDRESS IN (SELECT FOUNDATION FROM foundation_list) THEN - RAW_AMOUNT/POW(10, 18)
          WHEN TO_ADDRESS IN (SELECT FOUNDATION FROM foundation_list) THEN RAW_AMOUNT/POW(10, 18)
          ELSE 0
        END
      ) AS daily_balance_change
    FROM
      ethereum.core.ez_token_transfers
    WHERE
      CONTRACT_ADDRESS = LOWER('0xa00a4d5786a6e955e9539d01d78bf68f3271c050')
      AND (FROM_ADDRESS in (SELECT FOUNDATION FROM foundation_list) OR TO_ADDRESS in (SELECT FOUNDATION FROM foundation_list))
      AND NOT (FROM_ADDRESS in (SELECT FOUNDATION FROM foundation_list) AND TO_ADDRESS in (SELECT FOUNDATION FROM foundation_list))
    GROUP BY TIMESTAMP
)

SELECT
  DISTINCT TIMESTAMP AS DATE,
  12000000000 - SUM(daily_balance_change) OVER (
    ORDER BY
      TIMESTAMP
  ) AS CIRCULATING,
  (EXTRACT(EPOCH FROM TIMESTAMP) - 1585699200)/86400 AS DAYS,
  CASE
    WHEN DAYS BETWEEN 0 AND 91 THEN 0 + DAYS * 834602.13
    WHEN DAYS BETWEEN 91 AND 183 THEN 75948794 + (DAYS-91) * 1412209
    WHEN DAYS BETWEEN 183 AND 275 THEN 205871985 + (DAYS-183) * 1499165
    WHEN DAYS BETWEEN 275 AND 365 THEN 343795176 + (DAYS-275) * 9512480
    WHEN DAYS BETWEEN 365 AND 456 THEN  1199918367 + (DAYS-365) * 13354101
    WHEN DAYS BETWEEN 456 AND 548 THEN  2415141558 + (DAYS-456) * 13208947
    WHEN DAYS BETWEEN 548 AND 640 THEN  3630364749 + (DAYS-548) * 13698078
    WHEN DAYS BETWEEN 640 AND 730 THEN  4890587940 + (DAYS-640) * 12859265
    WHEN DAYS BETWEEN 730 AND 821 THEN  6047921822 + (DAYS-730) * 13141604
    WHEN DAYS BETWEEN 821 AND 913 THEN  7243807836 + (DAYS-821) * 2982868
    WHEN DAYS BETWEEN 913 AND 1005 THEN  7518231749 + (DAYS-913) * 4867310
    WHEN DAYS BETWEEN 1005 AND 1095 THEN  7966024322 + (DAYS-1005) * 4885752
    WHEN DAYS BETWEEN 1095 AND 1186 THEN  8405742004 + (DAYS-1095) * 4985734
    WHEN DAYS BETWEEN 1186 AND 1278 THEN  8859443810 + (DAYS-1186) * 5107501
    WHEN DAYS BETWEEN 1278 AND 1370 THEN  9329333988 + (DAYS-1278) * 5311198
    WHEN DAYS BETWEEN 1370 AND 1460 THEN  9817964231 + (DAYS-1370) * 5429224
    WHEN DAYS BETWEEN 1460 AND 1551 THEN  10306594474 + (DAYS-1460) * 5369563
    WHEN DAYS BETWEEN 1551 AND 1643 THEN  10795224717 + (DAYS-1551) * 5311198
    WHEN DAYS BETWEEN 1643 AND 1735 THEN  11283854960 + (DAYS-1643) * 5311198
    WHEN DAYS > 1735 THEN  12000000000
  END AS PLANNED
FROM
  daily_transfers
ORDER BY
  TIMESTAMP;
